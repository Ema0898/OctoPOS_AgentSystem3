#ifndef OS_AGENT_AGENT_INIT_AH
#define OS_AGENT_AGENT_INIT_AH

#include "hw/hal/CPU.h"
#include "os/agent3/Agent.h"

aspect Agent_Init {
    //advice execution("void os::krn::System::boot_complete()") : after() {
    //advice execution("void os::krn::System::init()") : after() {

    pointcut initWrapper() = execution("void os::proc::ContextManager::initWrapper()");
    advice initWrapper() : around() {
        if (hw::hal::CPU::getCPUID() == 0) {
            os::agent::AgentSystem::init();
        }
        tjp->proceed();
    }

    advice initWrapper() : order("IRQSyncHard", "Agent_Init");
};

#endif
